---
title: Diario
published: true
---

<p>Hola aqui estara mi blog donde les mostrare lo que aprendo cada dia, y algunas cosas que ya tengo en cuenta pero que les quiero compartir.</p>
Me pudes contactar por Facebook -> [aqui](https://www.facebook.com/santiagodavid.alvaradocelis)

---
<br>
<p><font color="yellow">[<font color="red">*</font>]</font> <b> : Creacion de usuario y permisos.</b></p>
<br>
<p><font color="yellow">[<font color="red">*</font>]</font><font color="lime"> Reconocimiento en un sistema</font></p>
<p>En linux podemos enumerar los usario activos en el sistema con un par de comandos :</p>
```#!/bin/bash
cat /etc/passwd | grep "sh$" | awk 'NF{print $1}' FS=':'
```

<p><font color="yellow">[<font color="red">*</font>]</font> Creacion de usuarios en el sistema : </p>
<p> Esto es un poco importante ya que este pude ser un vector de vulnerabilidad a explotar.</p>
<p><b>Creacion de usuario :</b></p>
```1
sudo mkdir /home/usuario1 && useradd -d /home/usuario1 -s /bin/bash usuario1
```
<p>Creamos carpeta y posteriormente el usuario. <b>Resumen:</b></p>

* -d siginifica la carpeta del nuevo usuario.

* -s la shell por defecto para el nuevo usuario en este caso<b> usuario1</b>.

<br>
<p> Para ponerle propietario a usuario1 ejecutamos :</p>
```1
sudo chown root:usario1 usuario1
```
<p> En este caso <font color="red">Root</font> es el propietario, para <b>eliminar el usuario simplemente</b> : </p>
```1
sudo userdel usuario1
```
---
<p><font color="yellow">[<font color="red">*</font>]</font> Permisos</p>

<p>Permisos sobre un archivo este se puede <b>resumir</b> en lo siguiente</p>
* r -> Pude leer el fichero [ read ].

* w -> Puede escrbir el fichero [ read ].

* x -> pude ejuctar el archivo [ executable ] o <b>Directorio</b> le permite entonces entrar al directorio.

<br>
<P><b>E</b>stos permisos se dividen en 3 secciones, en este caso es usaremos como ejemplo este permiso:</p> 
`rwx-rwx-rwx`
<p>El cual, esto se pude resumir en :</p>

```
rxw rxw rxw
 p   g   o
```
<p> <font color="yellow">[<font color="red">*</font>]</font> Donde : </p>

* p -> Corresponde al propietario.

* g -> Grupos del propietario.

* o -> Cualquier otra persona.

<br>
Es decir si este permiso estubiera activo ahora `rwx-rwx-rwx` en un archivo, todos tendrian permiso de lectura, escritura, ejecucion.

<font color="lime"><font color="yellow">[<font color="red">*</font>]</font> 2022-07-29</font>
<p><b>P</b>ara los grupos en concreto sea crea de la siguiente forma :</p>
```1
groupadd grupo1
```
Podemos ver el grupo con :
```1
cat /etc/group
```
<p>En la ultima linea estara el grupo que creamos.</p>
<br>

<p>Para ponerle a un determinado <b>grupo</b> un directorio o fichero se hace de la siguienete forma : </p>
```1
chgrp grupo1 directorio1
```
<p>Para añadir a un determinado usuario al grupo se hace de la siguiente manera :</p>
```1
usermod -a -G grupo1 usuario1
```
<p><font color="yellow">[<font color="red">*</font>]</font> Donde : </p>
* <p><font color="">a</font> -> Añadir.</p>

* <p><font color="">G </font>-> Grupo.</p>
<br>

<p>Para ver si el grupo corresponde al usuario podemos hacer :</p>
```1
id usuario1
```
<p>En la parte final estara en un parentesis su grupo, podemos hacer tambien :</p>
```1
id usario1 | tr '()' '\n' | grep "Aqui su grupo a buscar"
```
<p>Una variante de chmod es chattr el cual nos permite efectuar permisos avanzados, esta variante que vamos a hacer
es para que ni <font color="red">Root</font> puede eliminar el archivo creado  entonces : </p>
```1
chattr +i -V ejemplo.txt
```
<p><font color="yellow">[<font color="red">*</font>]</font> Donde:</p>
* +i -> Quiero añadir una flag.

* -V -> Verbose, es decir muestrame por pantalla los cambios efectuados.

<br>
<p> Ahora si hacemos ls -l no vamos a mirar el permiso creado. Para verlo solo se hace con el siguiente comando : </p>
```1
lsattr ejemplo.txt
```
<p>Veremos solo una <font color="yellow"> --i-- </font> que es el respectivo permiso asignado,
lo que hace  que <b>repito</b> ni <font color="red">Root</font> pueda eliminar ese archivo.</p>

<p>Para eliminar el archivo solo tenemos que quitar el permiso entonces para eso :</p>
```1
sudo chattr -i -V ejemplo.txt
```
De esta manera ya pudes hacerle el `rm -rf ejemplo.txt` y te deberia dejar.
<p></p>
-----
<br>
<h3><font color="yellow">[<font color="red">*</font>]</font><font color="lime"> Explotacion y vulnerabilidad de permisos.</font></h3>
<p><font color="yellow"></font> Explotacion por SUID : </p>
<p>Un vector potencial de ataque, donde si hay un comando el cual el propietario es <font color="red">Root</font>
y tenemos permisos <b>SUID</b> sobre un comando, el cual por parametros sea capas de poder ejecutar un comando, podemos
crear una shell como <font color="red">Root</font> sin proporcionar contraseñas.</p>

<p><font color="yellow">[<font color="red">*</font>]</font> Localisamos un comando que sea de propietario <font color="red">Root</font> y que en este caso sea capas de ejecutar comandos en este caso usare
el comando <font color="blue">find</font> el cumple con los requisitos. Ya que</p>
* El propietario es root.
* Con el parametro `-exec` que me permite ejecutar comandos.

<br>
<p>Empezamos viendo los permisos que tiene y su ruta que en mi caso se aloja en la ruta <font color="blue">/usr/bin/find</font>
de seguido miramos sus permisos, para ello :</p>
```1
which find | xargs ls -l
```
<p>Aparecera algo asi : </p>
`r--rwxr-x root root 259 KB Wed Feb  2 05:55:26 2022  /usr/bin/find`

Si observan en los permisos que tiene, no aparece el SUID que se representa con una  `s` para ello si queremos otorgarles permisos de <font color="blue">SUID</font> hacemos :
```1
sudo chmod 4775 /usr/bin/find
```
Claro para otorgarle permisos se necesita de usario <font color="red">Root</font> pero esto solo por una vez, si hacemos de nuevo `which find | xargs ls -l` vemos que en los permisos ya aparece la letra `s` algo asi :
<p></p>
`.rwsrwxr-x root root 259 KB Wed Feb  2 05:55:26 2022  /usr/bin/find`
<p>Ya con esto tendriamos una shell un puerta donde nos metemos como <font color="red">Root</font> sin proporcionar contraseña</p>
para crearnos una [ReverseShell](https://www.google.com/search?client=firefox-b-d&q=ReverseShell)
como <font color="Red">Root</font> hacemos :
```1
find . -exec /bin/bash -p \; -quit
```
<p>y nos creara una ReverseShell como <font color="red">Root</font> siendo cualquier usuario del sistema.
Para revertir el cambio, y que ya ninguno puda crearce un shell como <font color="red">Root</font> ejecutas el siguiente comando :</p>
```1
chmod 775 /usr/bin/find
```
